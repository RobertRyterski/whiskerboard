{% extends "whiskerboard/base.html" %}
{% load static from staticfiles %}
{% block content %}

{% regroup services|dictsort:"category.name" by category as category_list %}

      <div id="webservices" class="frame">

	{% for category in category_list %}

	<h2 class="category">{{ category.grouper.name }}</h2>
	<div class="category-desc">
	  {{ category.grouper.description|safe }}
	</div>

          <table id="service-list">
            <thead>
              <tr>
                <th>Service</th>
                <th class="today">Current</th>
              
                {% for day in past %}
                  <th class="date">{{ day|date:"N j" }}</th>
                {% endfor %}

            </thead>

            <tbody id="services-body">
              {% for service in category.list %}
              {% with latest_status_img="images/status/"|add:service.events.latest.status.image latest_status=service.events.latest.status default_image="images/status/"|add:default.image status_image="images/status/"|add:status.image|add:".png" %}
              
                <tr>
                  <td>
                    <a href="{{ service.get_absolute_url }}">
                      {{ service.name }} </a>
                  </td>
                  
                  <td class="status highlight">
		    <a href="{{ service.get_absolute_url }}">
        {% if latest_status_image %}
          <img src="{% static latest_status_img %}.png"
                      alt="{{ latest_status }}"/>
		    {% else %}
          <img src="{% static default_image %}.png"
                      alt="{{ default.name }}"/>
        {% endif %}
		    </a>
                  </td>
                  
                  {% for status in service.last_five_days %}
                    <td class="status">
                      <img src="{% static status_image %}" alt="{{ status.image }}">
                    </td>
                  {% endfor %}
                      
                </tr>
              {% endwith %}
             {% endfor %}
              
            </tbody>
          </table>
        
        {% endfor %}

        
        {% include "whiskerboard/_legend.html" %}
        
      </div>
      
{% endblock %}

