{% extends "whiskerboard/base.html" %}
{% load static from staticfiles %}
{% block content %}

{% regroup services|dictsort:"category.name" by category as category_list %}
<div id="webservices" class="frame">
    {% for category in category_list %}
    <h2 class="category">{{ category.grouper.name }}</h2>
    <div class="category-desc">
        {{ category.grouper.description|safe }}
    </div>
    <table id="service-list">
        <thead>
            <tr>
                <th>Service</th>
                <th class="today">Current</th>
                {% for day in past %}
                <th class="date">{{ day|date:"N j" }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="services-body">
            {% for service in category.list %}
            <tr>
                <td><a href="{{ service.get_absolute_url }}">{{ service.name }}</a></td>
                <td class="status highlight">
                    <a href="{{ service.get_absolute_url }}">
                        {% if service.events.latest.status %}
                        <img src="{% static service.events.latest.status.image_url %}"
                            alt="{{ service.events.latest.status.name }}"/>
                        {% else %}
                        <img src="{% static default.image_url %}"
                            alt="{{ default.name }}"/>
                        {% endif %}
                    </a>
                </td>
                {% for status in service.last_five_days %}
                <td class="status">
                    <img src="{% static status.image %}" alt="{{ status.image }}" />
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}
    {% include "whiskerboard/legend.html" %}
</div>
{% endblock %}
